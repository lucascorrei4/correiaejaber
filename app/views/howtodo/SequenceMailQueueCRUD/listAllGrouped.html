#{extends 'CRUD/layoutPub.html' /}
#{set title:messages.get('crud.list.title', type.name) /}
<meta charset="utf-8" />
	<div class="row">
		<div class="col-lg-12">
			<div class="col-lg-6">
				#{crud.searchAll /}
			</div>
			<div class="col-lg-6">
			</div>
		</div>
	</div>
	<div class="col-lg-12 ${type.name}">
        <div class="panel panel-default">
            <div class="panel-heading">
				<div class="form-group">
				    <label for="object_services">
				        Busca
				    </label>
					<div id="accordion_search_bar_container">
						<input type="search" class="form-control" id="accordion_search_bar" placeholder="Pesquise por algum termo" />
					</div>
				</div>
				<div class="alert alert-success alert-dismissable">
                   <button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button>
                   <strong>Atenção:</strong> Ao excluir um e-mail haverá nova tentativa de envio no próximo intervalo. Tenha cautela!
               </div>
            </div>
			<div class="panel-body" id="page_container">
				<div class="panel-group" id="accordion" role="tablist"
					aria-multiselectable="true">
					#{list items:listGroupedUrls, as:'groupedUrl'}
						<div class="panel panel-${groupedUrl_index % 2 == 0 ? 'info' : 'default'}" id="collapse${groupedUrl_index}_container">
							<div class="panel-heading" role="tab" id="heading${groupedUrl_index}">
								<h4 class="panel-title">
									<a role="button" data-toggle="collapse" data-parent="#accordion"
										href="#collapse${groupedUrl_index}" aria-expanded="true"
										aria-controls="collapse${groupedUrl_index}"> Página: <strong>${groupedUrl.url}</strong> </a>
								</h4>
							</div>
							<div id="collapse${groupedUrl_index}" class="panel-collapse collapse"
								role="tabpanel" aria-labelledby="heading${groupedUrl_index}">
								<div class="panel-body">
									<div class="table-responsive" style="padding: 3px !important">
										<div class="row">
							                <div class="col-lg-3 col-md-6" style="margin: 0 0 3px 0;">
							                    <div class="panel panel-primary">
							                        <div class="panel-heading">
							                            <div class="row">
							                                <div class="col-xs-3">
							                                </div>
							                                <div class="col-xs-9 text-right">
							                                    <div class="huge">${groupedUrl.total}</div>
							                                    <div>Total</div>
							                                </div>
							                            </div>
							                        </div>
							                    </div>
							                </div>
							                <div class="col-lg-3 col-md-6" style="margin: 0 0 3px 0;">
							                    <div class="panel panel-green">
							                        <div class="panel-heading">
							                            <div class="row">
							                                <div class="col-xs-3">
							                                </div>
							                                <div class="col-xs-9 text-right">
							                                    <div class="huge">${groupedUrl.totalSent}</div>
							                                    <div>Enviados</div>
							                                </div>
							                            </div>
							                        </div>
							                    </div>
							                </div>
							                <div class="col-lg-3 col-md-6" style="margin: 0 0 3px 0;">
							                    <div class="panel panel-yellow">
							                        <div class="panel-heading">
							                            <div class="row">
							                                <div class="col-xs-3">
							                                </div>
							                                <div class="col-xs-9 text-right">
							                                    <div class="huge">${groupedUrl.totalOpened}</div>
							                                    <div>Abertos</div>
							                                </div>
							                            </div>
							                        </div>
							                    </div>
							                </div>
							                <div class="col-lg-3 col-md-6" style="margin: 0 0 3px 0;">
							                    <div class="panel panel-red">
							                        <div class="panel-heading">
							                            <div class="row">
							                                <div class="col-xs-3">
							                                </div>
							                                <div class="col-xs-9 text-right">
							                                    <div class="huge">${groupedUrl.totalClicked}</div>
							                                    <div>Clicados</div>
							                                </div>
							                            </div>
							                        </div>
							                    </div>
							                </div>
            							</div>
            							<hr>
            							<div class="panel-group" id="accordion2" role="tablist"
											aria-multiselectable="true">
											#{list items:groupedUrl.listSequenceMail, as:'sequenceMail'}
												<div class="panel panel-${sequenceMail_index % 2 == 0 ? 'info' : 'default'}" id="collapse${sequenceMail_index}_container">
													<div class="panel-heading" role="tab" id="heading2-${sequenceMail_index}-${sequenceMail.id}">
														<h4 class="panel-title">
															<a role="button" data-toggle="collapse" data-parent="#accordion2"
																href="#collapse2-${sequenceMail_index}-${sequenceMail.id}" aria-expanded="true"
																aria-controls="collapse2-${sequenceMail_index}-${sequenceMail.id}"> E-mail: <strong>${sequenceMail.title}</strong> </a>
														</h4>
													</div>
													<div id="collapse2-${sequenceMail_index}-${sequenceMail.id}" class="panel-collapse collapse"
														role="tabpanel" aria-labelledby="heading2-${sequenceMail_index}-${sequenceMail.id}">
														<div class="panel-body">
															<div class="table-responsive">
																<table class="table table-striped">
								                                    <thead>
																		<div class="row" style="padding: 3px !important">
																			<div class="col-lg-4">
																				<div class="well well-sm">
																					<h4><strong>${sequenceMail.totalSent}</strong> Enviados</h4>
																				</div>
																			</div>
																			<div class="col-lg-4">
																				<div class="well well-sm">
																					<h4><strong>${sequenceMail.totalOpened}</strong> Abertos</h4>
																				</div>
																			</div>
																			<div class="col-lg-4">
																				<div class="well well-sm">
																					<h4><strong>${sequenceMail.totalClicked}</strong> Clicados</h4>
																				</div>
																			</div>
								            							</div>
								                                        <tr>
								                                            <th>Data Envio</th>
								                                            <th>E-mail</th>
								                                            <th>Enviado</th>
								                                            <th>Aberto</th>
								                                            <th>Clicado</th>
								                                            <th>Ações</th>
								                                        </tr>
								                                    </thead>
								                                    <tbody>
																		#{list items:sequenceMail.listSequenceMailQueue, as:'sequenceMailQueue'}
									                                        <tr>
															         			<td><a href="@{howtodo.SequenceMailQueueCRUD.show(sequenceMailQueue.id)}">${sequenceMailQueue.jobDateParsed}</a></td>
															         			<td><a href="@{howtodo.SequenceMailQueueCRUD.show(sequenceMailQueue.id)}">${sequenceMailQueue.mail}</a></td>
															         			<td><a href="@{howtodo.SequenceMailQueueCRUD.show(sequenceMailQueue.id)}">${sequenceMailQueue.sent ? 'Sim' : 'Não'}</a></td>
															         			<td><a href="@{howtodo.SequenceMailQueueCRUD.show(sequenceMailQueue.id)}">${sequenceMailQueue.mailRead ? 'Sim' : 'Não'}</a></td>
															         			<td><a href="@{howtodo.SequenceMailQueueCRUD.show(sequenceMailQueue.id)}">${sequenceMailQueue.mailClicked ? 'Sim' : 'Não'}</a></td>
																	    		<td>
																	    			<div class="dropdown">
																						<button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu${sequenceMailQueue.id}" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
																						  <i class="fa fa-wrench"></i> <span class="caret"></span>
																						</button>
																						<ul class="dropdown-menu" aria-labelledby="dropdownMenu${sequenceMail.id}">
														                                    <li class="divider"></li>
														                                    <li><a href="@{howtodo.SequenceMailQueueCRUD.remove(sequenceMailQueue.id)}">Excluir</a>
																						</ul>
																					</div>
																				</td>
									                                        </tr>
																		#{/list}
								                                    </tbody>
								                                </table>
															</div>
														</div>
													</div>
												</div>
											#{/list}
										</div>
									</div>
								</div>
							</div>
						</div>
					#{/list}
				</div>
			</div>
   		</div>
   	</div>
